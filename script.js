document.addEventListener('DOMContentLoaded', () => {
    const elements = {
        title: document.getElementById('title'),
        footer: document.getElementById('footer'),
        feelsLikeLabel: document.getElementById('feelsLikeLabel'),
        humidityLabel: document.getElementById('humidityLabel'),
        windLabel: document.getElementById('windLabel'),
        waterTempHeader: document.getElementById('waterTempHeader'),
        waterPhHeader: document.getElementById('waterPhHeader'),
        soilMoistureHeader: document.getElementById('soilMoistureHeader'),
        pumpControlHeader: document.getElementById('pumpControlHeader'),
        pumpSwitch: document.getElementById('pumpSwitch'),
        tempValue: document.getElementById('tempValue'), phValue: document.getElementById('phValue'), moistureValue: document.getElementById('moistureValue'),
        tempAlert: document.getElementById('tempAlert'), phAlert: document.getElementById('phAlert'), moistureAlert: document.getElementById('moistureAlert'),
        tempCard: document.getElementById('tempCard'), phCard: document.getElementById('phCard'), moistureCard: document.getElementById('moistureCard'),
        weatherTemp: document.getElementById('weatherTemp'), weatherDesc: document.getElementById('weatherDesc'),
        weatherFeelsLike: document.getElementById('weatherFeelsLike'), weatherHumidity: document.getElementById('weatherHumidity'),
        weatherWind: document.getElementById('weatherWind'), weatherIcon: document.getElementById('weatherIcon'),
        botMessage: document.getElementById('botMessage'), botLogTooltip: document.getElementById('botLogTooltip'),
        botAvatar: document.getElementById('botAvatar'), botContainer: document.getElementById('botContainer'),
        languageSelect: document.getElementById('languageSelect')
    };

    // Add chat elements dynamically for better bot interaction
    const chatContainer = document.createElement('div');
    chatContainer.id = 'botChatContainer';
    chatContainer.className = 'bot-chat-container';
    chatContainer.innerHTML = `
        <div class="bot-chat-header">
            <span class="bot-chat-title">AgriBot Assistant</span>
            <button id="closeChat" class="close-chat-btn">&times;</button>
        </div>
        <div id="chatMessages" class="chat-messages"></div>
        <div class="chat-input-container">
            <input type="text" id="chatInput" placeholder="Ask me about your system... (e.g., 'status', 'tip', 'pH advice')" maxlength="200">
            <button id="sendMessage">Send</button>
        </div>
    `;
    elements.botContainer.appendChild(chatContainer);
    chatContainer.style.display = 'none';

    const chatElements = {
        chatContainer: chatContainer,
        closeChat: chatContainer.querySelector('#closeChat'),
        chatMessages: chatContainer.querySelector('#chatMessages'),
        chatInput: chatContainer.querySelector('#chatInput'),
        sendMessage: chatContainer.querySelector('#sendMessage')
    };

    let currentLanguage = 'en';

    const translations = {
        en: {
            title: 'Waste to Taste - Agriculture Monitoring System',
            footer: 'Waste to Taste | Real-Time Clean Agriculture Monitoring System',
            feelsLike: 'Feels Like',
            humidity: 'Humidity',
            wind: 'Wind',
            waterTemperature: 'Water Temperature',
            waterPhLevel: 'Water pH Level',
            soilMoisture: 'Soil Moisture',
            pumpControl: 'Pump Control',
            tempTooLow: 'Temperature too low!',
            tempTooHigh: 'Temperature too high!',
            phAcidic: 'pH is acidic!',
            phAlkaline: 'pH is alkaline!',
            moistureTooLow: 'Moisture too low!',
            moistureTooHigh: 'Moisture too low!',
            time: 'Time',
            weatherConditions: {
                Clear: 'Clear',
                Clouds: 'Clouds',
                Rain: 'Rain',
                Drizzle: 'Drizzle',
                Thunderstorm: 'Thunderstorm',
                Snow: 'Snow',
                Fog: 'Fog',
                Unknown: 'Unknown'
            },
            proactiveTips: [
                "Remember to check plant leaves for any signs of pests or nutrient deficiencies.",
                "Clean water is happy water! Ensure your reservoir is clean to prevent algae growth.",
                "Proper airflow is important. Make sure the area around the plants is well-ventilated.",
                "Have you checked nutrient solution levels recently? Topping up is key for steady growth.",
                "Rotate the plants if possible to ensure they get even light exposure.",
                "Monitor EC levels alongside pH to avoid imbalances.",
                "Consider adding beneficial microbes to boost root health.",
                "Prune dead leaves to improve light penetration and reduce disease risk."
            ],
            botMessages: {
                phLowCritical: "üö® CRITICAL: pH is dangerously low (acidic)! This can lock out nutrients‚Äîadd pH up solution immediately and test again.",
                phHighCritical: "üö® CRITICAL: pH is dangerously high (alkaline)! Risk of nutrient lockout‚Äîadd pH down and monitor closely.",
                tempLowCritical: "üö® CRITICAL: Water temp too cold! Roots may shock; use a heater or insulate the reservoir ASAP.",
                tempHighCritical: "üö® CRITICAL: Water too hot! Oxygen levels dropping‚Äîadd aeration or cool the system to protect roots.",
                phLowWarning: "‚ö†Ô∏è pH slightly acidic. Watch for yellowing leaves; consider a small dose of pH adjuster.",
                phHighWarning: "‚ö†Ô∏è pH slightly alkaline. Nutrient uptake might suffer; test and adjust if needed.",
                wateringTimeOff: "üíß Watering time! Pump is off‚Äîturn it on to keep your plants hydrated during peak hours.",
                wateringDoneOn: "‚úÖ Watering cycle complete. Pump on unnecessarily? Turn off to conserve energy and prevent overwatering.",
                hotSunnyPumpOff: "‚òÄÔ∏èüíß Hot & sunny during watering slot! Activate the pump now to combat evaporation stress.",
                goodMorning: "üåÖ Good morning! Systems stable‚Äîperfect day for growth. Quick tip: Check for morning dew on leaves.",
                goodEvening: "üåô Good evening. All good here. Wind down by inspecting for evening pests.",
                status: "üìä Current status: Temp: {temp}¬∞C, pH: {ph}, Moisture: {moisture}%. Weather: {weather}. Pump: {pump}. All looks optimal!",
                tip: "üí° {tip}",
                phAdvice: "üß™ Ideal pH for hydroponics: 5.5-6.5. Yours at {ph}‚Äîif off, adjust gradually (0.2-0.3 units) and retest in 30 min.",
                tempAdvice: "üå°Ô∏è Optimal water temp: 18-24¬∞C. At {temp}¬∞C, ensure good oxygenation to avoid root rot.",
                moistureAdvice: "üí¶ Soil moisture ideal: 40-60%. At {moisture}%, {moistureAdvice}.",
                weatherImpact: "‚òÅÔ∏è With {weather} at {weatherTemp}¬∞C, {weatherTip}.",
                unknown: "ü§î Sorry, I didn't catch that. Try 'status', 'tip', 'pH advice', or describe an issue!"
            },
            botInit: `Hello! AgriBot activated at ${time}. I'm here to monitor, advise, and chat about your grow op. Click me anytime!`,
            chatPlaceholder: "Ask me about your system... (e.g., 'status', 'tip', 'pH advice')"
        },
        hi: {
            // ... (keep existing Hindi translations, add new ones similarly)
            title: 'Waste to Taste - ‡§ï‡•É‡§∑‡§ø ‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä',
            footer: 'Waste to Taste | ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§∏‡§Æ‡§Ø ‡§∏‡•ç‡§µ‡§ö‡•ç‡§õ ‡§ï‡•É‡§∑‡§ø ‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä',
            feelsLike: '‡§ê‡§∏‡§æ ‡§≤‡§ó‡§§‡§æ ‡§π‡•à',
            humidity: '‡§Ü‡§∞‡•ç‡§¶‡•ç‡§∞‡§§‡§æ',
            wind: '‡§π‡§µ‡§æ',
            waterTemperature: '‡§ú‡§≤ ‡§§‡§æ‡§™‡§Æ‡§æ‡§®',
            waterPhLevel: '‡§ú‡§≤ ‡§™‡•Ä‡§è‡§ö ‡§∏‡•ç‡§§‡§∞',
            soilMoisture: '‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•Ä ‡§®‡§Æ‡•Ä',
            pumpControl: '‡§™‡§Ç‡§™ ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£',
            tempTooLow: '‡§§‡§æ‡§™‡§Æ‡§æ‡§® ‡§¨‡§π‡•Å‡§§ ‡§ï‡§Æ ‡§π‡•à!',
            tempTooHigh: '‡§§‡§æ‡§™‡§Æ‡§æ‡§® ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ß‡§ø‡§ï ‡§π‡•à!',
            phAcidic: '‡§™‡•Ä‡§è‡§ö ‡§Ö‡§Æ‡•ç‡§≤‡•Ä‡§Ø ‡§π‡•à!',
            phAlkaline: '‡§™‡•Ä‡§è‡§ö ‡§ï‡•ç‡§∑‡§æ‡§∞‡•Ä‡§Ø ‡§π‡•à!',
            moistureTooLow: '‡§®‡§Æ‡•Ä ‡§¨‡§π‡•Å‡§§ ‡§ï‡§Æ ‡§π‡•à!',
            moistureTooHigh: '‡§®‡§Æ‡•Ä ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ß‡§ø‡§ï ‡§π‡•à!',
            time: '‡§∏‡§Æ‡§Ø',
            weatherConditions: {
                Clear: '‡§∏‡§æ‡§´‡§º',
                Clouds: '‡§¨‡§æ‡§¶‡§≤',
                Rain: '‡§¨‡§æ‡§∞‡§ø‡§∂',
                Drizzle: '‡§¨‡•Ç‡§Ç‡§¶‡§æ‡§¨‡§æ‡§Ç‡§¶‡•Ä',
                Thunderstorm: '‡§Ü‡§Ç‡§ß‡•Ä',
                Snow: '‡§¨‡§∞‡•ç‡§´‡§¨‡§æ‡§∞‡•Ä',
                Fog: '‡§ï‡•ã‡§π‡§∞‡§æ',
                Unknown: '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§'
            },
            proactiveTips: [
                "‡§™‡•å‡§ß‡•ã‡§Ç ‡§ï‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§™‡§∞ ‡§ï‡•Ä‡§ü‡•ã‡§Ç ‡§Ø‡§æ ‡§™‡•ã‡§∑‡§ï ‡§§‡§§‡•ç‡§µ‡•ã‡§Ç ‡§ï‡•Ä ‡§ï‡§Æ‡•Ä ‡§ï‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡§®‡§æ ‡§Ø‡§æ‡§¶ ‡§∞‡§ñ‡•á‡§Ç‡•§",
                "‡§∏‡•ç‡§µ‡§ö‡•ç‡§õ ‡§™‡§æ‡§®‡•Ä ‡§ñ‡•Å‡§∂ ‡§™‡§æ‡§®‡•Ä ‡§π‡•à! ‡§∂‡•à‡§µ‡§æ‡§≤ ‡§ï‡•á ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§ï‡•ã ‡§∞‡•ã‡§ï‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡•á ‡§ú‡§≤‡§æ‡§∂‡§Ø ‡§ï‡•ã ‡§∏‡§æ‡§´ ‡§∞‡§ñ‡•á‡§Ç‡•§",
                "‡§â‡§ö‡§ø‡§§ ‡§µ‡§æ‡§Ø‡•Å ‡§™‡•ç‡§∞‡§µ‡§æ‡§π ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•à‡•§ ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§™‡•å‡§ß‡•ã‡§Ç ‡§ï‡•á ‡§Ü‡§∏‡§™‡§æ‡§∏ ‡§ï‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§§‡§∞‡§π ‡§π‡§µ‡§æ‡§¶‡§æ‡§∞ ‡§π‡•ã‡•§",
                "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™‡§®‡•á ‡§π‡§æ‡§≤ ‡§π‡•Ä ‡§Æ‡•á‡§Ç ‡§™‡•ã‡§∑‡§ï ‡§ò‡•ã‡§≤ ‡§ï‡•á ‡§∏‡•ç‡§§‡§∞ ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡•Ä ‡§π‡•à? ‡§∏‡•ç‡§•‡§ø‡§∞ ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ü‡•â‡§™‡§ø‡§Ç‡§ó ‡§Ö‡§™ ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•à‡•§",
                "‡§Ø‡§¶‡§ø ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•ã ‡§§‡•ã ‡§™‡•å‡§ß‡•ã‡§Ç ‡§ï‡•ã ‡§ò‡•Å‡§Æ‡§æ‡§è‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§∏‡§Æ‡§æ‡§® ‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§Æ‡§ø‡§≤‡•á‡•§",
                "‡§™‡•Ä‡§è‡§ö ‡§ï‡•á ‡§∏‡§æ‡§• ‡§à‡§∏‡•Ä ‡§∏‡•ç‡§§‡§∞ ‡§ï‡•Ä ‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä ‡§ï‡§∞‡•á‡§Ç ‡§Ö‡§∏‡§Ç‡§§‡•Å‡§≤‡§® ‡§∏‡•á ‡§¨‡§ö‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è‡•§",
                "‡§ú‡§°‡§º ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§¨‡§¢‡§º‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡§æ‡§≠‡§ï‡§æ‡§∞‡•Ä ‡§∏‡•Ç‡§ï‡•ç‡§∑‡•ç‡§Æ‡§ú‡•Ä‡§µ ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§™‡§∞ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§",
                "‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§Æ‡•á‡§Ç ‡§∏‡•Å‡§ß‡§æ‡§∞ ‡§î‡§∞ ‡§∞‡•ã‡§ó ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§ï‡§Æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡•É‡§§ ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§õ‡§æ‡§Ç‡§ü‡•á‡§Ç‡•§"
            ],
            botMessages: {
                phLowCritical: "üö® ‡§ó‡§Ç‡§≠‡•Ä‡§∞: ‡§™‡•Ä‡§è‡§ö ‡§ñ‡§§‡§∞‡§®‡§æ‡§ï ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ï‡§Æ (‡§Ö‡§Æ‡•ç‡§≤‡•Ä‡§Ø)! ‡§™‡•ã‡§∑‡§ï ‡§§‡§§‡•ç‡§µ ‡§≤‡•â‡§ï‡§Ü‡§â‡§ü ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‚Äî‡§§‡•Å‡§∞‡§Ç‡§§ ‡§™‡•Ä‡§è‡§ö ‡§Ö‡§™ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç ‡§î‡§∞ ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§ï‡§∞‡•á‡§Ç‡•§",
                phHighCritical: "üö® ‡§ó‡§Ç‡§≠‡•Ä‡§∞: ‡§™‡•Ä‡§è‡§ö ‡§ñ‡§§‡§∞‡§®‡§æ‡§ï ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§â‡§ö‡•ç‡§ö (‡§ï‡•ç‡§∑‡§æ‡§∞‡•Ä‡§Ø)! ‡§™‡•ã‡§∑‡§ï ‡§≤‡•â‡§ï‡§Ü‡§â‡§ü ‡§ï‡§æ ‡§ú‡•ã‡§ñ‡§ø‡§Æ‚Äî‡§™‡•Ä‡§è‡§ö ‡§°‡§æ‡§â‡§® ‡§ú‡•ã‡§°‡§º‡•á‡§Ç ‡§î‡§∞ ‡§®‡§ú‡§¶‡•Ä‡§ï‡•Ä ‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä ‡§ï‡§∞‡•á‡§Ç‡•§",
                tempLowCritical: "üö® ‡§ó‡§Ç‡§≠‡•Ä‡§∞: ‡§ú‡§≤ ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ‡§¨‡§π‡•Å‡§§ ‡§†‡§Ç‡§°‡§æ! ‡§ú‡§°‡§º‡•á‡§Ç ‡§ù‡§ü‡§ï‡§æ ‡§ñ‡§æ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡§Ç; ‡§π‡•Ä‡§ü‡§∞ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç ‡§Ø‡§æ ‡§ú‡§≤‡§æ‡§∂‡§Ø ‡§ï‡•ã ‡§á‡§Ç‡§∏‡•Å‡§≤‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§",
                tempHighCritical: "üö® ‡§ó‡§Ç‡§≠‡•Ä‡§∞: ‡§ú‡§≤ ‡§¨‡§π‡•Å‡§§ ‡§ó‡§∞‡•ç‡§Æ! ‡§ë‡§ï‡•ç‡§∏‡•Ä‡§ú‡§® ‡§ï‡§Æ ‡§π‡•ã ‡§∞‡§π‡§æ‚Äî‡§è‡§∞‡•á‡§∂‡§® ‡§ú‡•ã‡§°‡§º‡•á‡§Ç ‡§Ø‡§æ ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•ã ‡§†‡§Ç‡§°‡§æ ‡§ï‡§∞‡•á‡§Ç‡•§",
                phLowWarning: "‚ö†Ô∏è ‡§™‡•Ä‡§è‡§ö ‡§•‡•ã‡§°‡§º‡§æ ‡§Ö‡§Æ‡•ç‡§≤‡•Ä‡§Ø‡•§ ‡§™‡•Ä‡§≤‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§™‡§∞ ‡§®‡§ú‡§∞ ‡§∞‡§ñ‡•á‡§Ç; ‡§™‡•Ä‡§è‡§ö ‡§è‡§°‡§ú‡§∏‡•ç‡§ü‡§∞ ‡§ï‡•Ä ‡§õ‡•ã‡§ü‡•Ä ‡§ñ‡•Å‡§∞‡§æ‡§ï ‡§™‡§∞ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§",
                phHighWarning: "‚ö†Ô∏è ‡§™‡•Ä‡§è‡§ö ‡§•‡•ã‡§°‡§º‡§æ ‡§ï‡•ç‡§∑‡§æ‡§∞‡•Ä‡§Ø‡•§ ‡§™‡•ã‡§∑‡§ï ‡§Ö‡§µ‡§∂‡•ã‡§∑‡§£ ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡§ø‡§§ ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à; ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§î‡§∞ ‡§∏‡§Æ‡§æ‡§Ø‡•ã‡§ú‡§® ‡§ï‡§∞‡•á‡§Ç‡•§",
                wateringTimeOff: "üíß ‡§™‡§æ‡§®‡•Ä ‡§¶‡•á‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø! ‡§™‡§Ç‡§™ ‡§¨‡§Ç‡§¶ ‡§π‡•à‚Äî‡§™‡•Ä‡§ï ‡§ò‡§Ç‡§ü‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§™‡•å‡§ß‡•ã‡§Ç ‡§ï‡•ã ‡§π‡§æ‡§á‡§°‡•ç‡§∞‡•á‡§ü‡•á‡§° ‡§∞‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ö‡§æ‡§≤‡•Ç ‡§ï‡§∞‡•á‡§Ç‡•§",
                wateringDoneOn: "‚úÖ ‡§™‡§æ‡§®‡•Ä ‡§ö‡§ï‡•ç‡§∞ ‡§™‡•Ç‡§∞‡§æ‡•§ ‡§™‡§Ç‡§™ ‡§Ö‡§®‡§æ‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ö‡§æ‡§≤‡•Ç? ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§¨‡§ö‡§æ‡§®‡•á ‡§î‡§∞ ‡§Ö‡§ß‡§ø‡§ï ‡§™‡§æ‡§®‡•Ä ‡§∏‡•á ‡§¨‡§ö‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç‡•§",
                hotSunnyPumpOff: "‚òÄÔ∏èüíß ‡§™‡§æ‡§®‡•Ä ‡§∏‡•ç‡§≤‡•â‡§ü ‡§ï‡•á ‡§¶‡•å‡§∞‡§æ‡§® ‡§ó‡§∞‡•ç‡§Æ ‡§î‡§∞ ‡§ß‡•Ç‡§™! ‡§µ‡§æ‡§∑‡•ç‡§™‡•Ä‡§ï‡§∞‡§£ ‡§§‡§®‡§æ‡§µ ‡§∏‡•á ‡§≤‡§°‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§¨ ‡§™‡§Ç‡§™ ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§ï‡§∞‡•á‡§Ç‡•§",
                goodMorning: "üåÖ ‡§∏‡•Å‡§™‡•ç‡§∞‡§≠‡§æ‡§§! ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§∏‡•ç‡§•‡§ø‡§∞‚Äî‡§µ‡•É‡§¶‡•ç‡§ß‡§ø ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§π‡•Ä ‡§¶‡§ø‡§®‡•§ ‡§ü‡§ø‡§™: ‡§∏‡•Å‡§¨‡§π ‡§ï‡•Ä ‡§ì‡§∏ ‡§™‡§∞ ‡§®‡§ú‡§∞ ‡§∞‡§ñ‡•á‡§Ç‡•§",
                goodEvening: "üåô ‡§∂‡•Å‡§≠ ‡§∏‡§Ç‡§ß‡•ç‡§Ø‡§æ‡•§ ‡§∏‡§¨ ‡§†‡•Ä‡§ï‡•§ ‡§∂‡§æ‡§Æ ‡§ï‡•á ‡§ï‡•Ä‡§ü‡•ã‡§Ç ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡§ï‡•á ‡§∞‡§ø‡§≤‡•à‡§ï‡•ç‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",
                status: "üìä ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§∏‡•ç‡§•‡§ø‡§§‡§ø: ‡§§‡§æ‡§™‡§Æ‡§æ‡§®: {temp}¬∞C, ‡§™‡•Ä‡§è‡§ö: {ph}, ‡§®‡§Æ‡•Ä: {moisture}%. ‡§Æ‡•å‡§∏‡§Æ: {weather}. ‡§™‡§Ç‡§™: {pump}. ‡§∏‡§¨ ‡§á‡§∑‡•ç‡§ü‡§§‡§Æ ‡§≤‡§ó ‡§∞‡§π‡§æ ‡§π‡•à!",
                tip: "üí° {tip}",
                phAdvice: "üß™ ‡§π‡§æ‡§á‡§°‡•ç‡§∞‡•ã‡§™‡•ã‡§®‡§ø‡§ï‡•ç‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§¶‡§∞‡•ç‡§∂ ‡§™‡•Ä‡§è‡§ö: 5.5-6.5‡•§ ‡§Ü‡§™‡§ï‡§æ {ph} ‡§™‡§∞‚Äî‡§Ø‡§¶‡§ø ‡§ë‡§´, ‡§ß‡•Ä‡§∞‡•á-‡§ß‡•Ä‡§∞‡•á ‡§∏‡§Æ‡§æ‡§Ø‡•ã‡§ú‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç (0.2-0.3 ‡§á‡§ï‡§æ‡§à) ‡§î‡§∞ 30 ‡§Æ‡§ø‡§®‡§ü ‡§Æ‡•á‡§Ç ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§ï‡§∞‡•á‡§Ç‡•§",
                tempAdvice: "üå°Ô∏è ‡§á‡§∑‡•ç‡§ü‡§§‡§Æ ‡§ú‡§≤ ‡§§‡§æ‡§™‡§Æ‡§æ‡§®: 18-24¬∞C‡•§ {temp}¬∞C ‡§™‡§∞, ‡§ú‡§°‡§º ‡§∏‡§°‡§º‡§® ‡§∏‡•á ‡§¨‡§ö‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§ë‡§ï‡•ç‡§∏‡•Ä‡§ú‡§®‡•á‡§∂‡§® ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§",
                moistureAdvice: "üí¶ ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§®‡§Æ‡•Ä ‡§Ü‡§¶‡§∞‡•ç‡§∂: 40-60%‡•§ {moisture}% ‡§™‡§∞, {moistureAdvice}‡•§",
                weatherImpact: "‚òÅÔ∏è {weatherTemp}¬∞C ‡§™‡§∞ {weather} ‡§ï‡•á ‡§∏‡§æ‡§•, {weatherTip}‡•§",
                unknown: "ü§î ‡§Æ‡§æ‡§´‡§º ‡§ï‡•Ä‡§ú‡§ø‡§è, ‡§Æ‡•à‡§Ç‡§®‡•á ‡§µ‡§π ‡§®‡§π‡•Ä‡§Ç ‡§∏‡§Æ‡§ù‡§æ‡•§ 'status', 'tip', '‡§™‡•Ä‡§è‡§ö ‡§∏‡§≤‡§æ‡§π' ‡§Ü‡§ú‡§º‡§Æ‡§æ‡§è‡§Ç ‡§Ø‡§æ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§µ‡§∞‡•ç‡§£‡§® ‡§ï‡§∞‡•á‡§Ç!"
            },
            botInit: `‡§®‡§Æ‡§∏‡•ç‡§§‡•á! AgriBot ${time} ‡§™‡§∞ ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø‡•§ ‡§Æ‡•à‡§Ç ‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä, ‡§∏‡§≤‡§æ‡§π ‡§î‡§∞ ‡§Ü‡§™‡§ï‡•á ‡§ó‡•ç‡§∞‡•ã ‡§ë‡§™ ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ö‡•à‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡§π‡§æ‡§Å ‡§π‡•Ç‡§Å‡•§ ‡§ï‡§π‡•Ä‡§Ç ‡§≠‡•Ä ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç!`,
            chatPlaceholder: "‡§Ö‡§™‡§®‡•á ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§™‡•Ç‡§õ‡•á‡§Ç... (‡§â‡§¶‡§æ‡§π‡§∞‡§£: 'status', 'tip', '‡§™‡•Ä‡§è‡§ö ‡§∏‡§≤‡§æ‡§π')"
        },
        gu: {
            // ... (keep existing Gujarati translations, add new ones similarly)
            title: 'Waste to Taste - ‡™ï‡´É‡™∑‡™ø ‡™Æ‡´ã‡™®‡™ø‡™ü‡™∞‡™ø‡™Ç‡™ó ‡™∏‡™ø‡™∏‡´ç‡™ü‡™Æ',
            footer: 'Waste to Taste | ‡™µ‡™æ‡™∏‡´ç‡™§‡™µ‡™ø‡™ï ‡™∏‡™Æ‡™Ø ‡™∏‡´ç‡™µ‡™ö‡´ç‡™õ ‡™ï‡´É‡™∑‡™ø ‡™Æ‡´ã‡™®‡™ø‡™ü‡™∞‡™ø‡™Ç‡™ó ‡™∏‡™ø‡™∏‡´ç‡™ü‡™Æ',
            feelsLike: '‡™Ö‡™®‡´Å‡™≠‡™µ‡™æ‡™Ø ‡™õ‡´á',
            humidity: '‡™≠‡´á‡™ú',
            wind: '‡™™‡™µ‡™®',
            waterTemperature: '‡™™‡™æ‡™£‡´Ä‡™®‡´Å‡™Ç ‡™§‡™æ‡™™‡™Æ‡™æ‡™®',
            waterPhLevel: '‡™™‡™æ‡™£‡´Ä‡™®‡´Å‡™Ç pH ‡™∏‡´ç‡™§‡™∞',
            soilMoisture: '‡™Æ‡™æ‡™ü‡´Ä‡™®‡´Ä ‡™≠‡´á‡™ú',
            pumpControl: '‡™™‡™Ç‡™™ ‡™®‡™ø‡™Ø‡™Ç‡™§‡´ç‡™∞‡™£',
            tempTooLow: '‡™§‡™æ‡™™‡™Æ‡™æ‡™® ‡™ñ‡´Ç‡™¨ ‡™®‡´Ä‡™ö‡´Å‡™Ç ‡™õ‡´á!',
            tempTooHigh: '‡™§‡™æ‡™™‡™Æ‡™æ‡™® ‡™ñ‡´Ç‡™¨ ‡™ä‡™Ç‡™ö‡´Å‡™Ç ‡™õ‡´á!',
            phAcidic: 'pH ‡™è‡™∏‡™ø‡™°‡™ø‡™ï ‡™õ‡´á!',
            phAlkaline: 'pH ‡™Ü‡™≤‡´ç‡™ï‡™≤‡™æ‡™á‡™® ‡™õ‡´á!',
            moistureTooLow: '‡™≠‡´á‡™ú ‡™ñ‡´Ç‡™¨ ‡™®‡´Ä‡™ö‡´Å‡™Ç ‡™õ‡´á!',
            moistureTooHigh: '‡™≠‡´á‡™ú ‡™ñ‡´Ç‡™¨ ‡™ä‡™Ç‡™ö‡´Å‡™Ç ‡™õ‡´á!',
            time: '‡™∏‡™Æ‡™Ø',
            weatherConditions: {
                Clear: '‡™∏‡´ç‡™™‡™∑‡´ç‡™ü',
                Clouds: '‡™µ‡™æ‡™¶‡™≥‡´ã',
                Rain: '‡™µ‡™∞‡™∏‡™æ‡™¶',
                Drizzle: '‡™ù‡™∞‡™Æ‡™∞',
                Thunderstorm: '‡™§‡´ã‡™´‡™æ‡™®',
                Snow: '‡™π‡™ø‡™Æ‡™µ‡™∞‡´ç‡™∑‡™æ',
                Fog: '‡™ß‡´Å‡™Æ‡´ç‡™Æ‡™∏',
                Unknown: '‡™Ö‡™ú‡™æ‡™£‡´ç‡™Ø‡´Å‡™Ç'
            },
            proactiveTips: [
                "‡™™‡´å‡™ß‡™æ‡™®‡™æ ‡™™‡™æ‡™Ç‡™¶‡™°‡™æ ‡™™‡™∞ ‡™ï‡´Ä‡™ü‡™ï‡´ã ‡™Ö‡™•‡™µ‡™æ ‡™™‡´ã‡™∑‡™ï ‡™§‡™§‡´ç‡™µ‡´ã‡™®‡´Ä ‡™â‡™£‡™™‡™®‡™æ ‡™ï‡´ã‡™à‡™™‡™£ ‡™ö‡™ø‡™π‡´ç‡™®‡´ã ‡™§‡™™‡™æ‡™∏‡™µ‡™æ‡™®‡´Å‡™Ç ‡™Ø‡™æ‡™¶ ‡™∞‡™æ‡™ñ‡´ã.",
                "‡™∏‡´ç‡™µ‡™ö‡´ç‡™õ ‡™™‡™æ‡™£‡´Ä ‡™ñ‡´Å‡™∂ ‡™™‡™æ‡™£‡´Ä ‡™õ‡´á! ‡™∂‡´á‡™µ‡™æ‡™≥ ‡™µ‡´É‡™¶‡´ç‡™ß‡™ø ‡™Ö‡™ü‡™ï‡™æ‡™µ‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´Ä ‡™§‡™Æ‡™æ‡™∞‡™æ ‡™ú‡™≥‡™æ‡™∂‡™Ø‡™®‡´á ‡™∏‡™æ‡™´ ‡™∞‡™æ‡™ñ‡´ã.",
                "‡™Ø‡´ã‡™ó‡´ç‡™Ø ‡™π‡™µ‡™æ ‡™™‡´ç‡™∞‡™µ‡™æ‡™π ‡™Æ‡™π‡™§‡´ç‡™µ‡™™‡´Ç‡™∞‡´ç‡™£ ‡™õ‡´á. ‡™ñ‡™æ‡™§‡™∞‡´Ä ‡™ï‡™∞‡´ã ‡™ï‡´á ‡™™‡´å‡™ß‡™æ ‡™Ü‡™∏‡™™‡™æ‡™∏‡™®‡´ã ‡™µ‡™ø‡™∏‡´ç‡™§‡™æ‡™∞ ‡™∏‡™æ‡™∞‡´Ä ‡™∞‡´Ä‡™§‡´á ‡™µ‡´á‡™®‡´ç‡™ü‡™ø‡™≤‡´á‡™ü‡´á‡™° ‡™õ‡´á.",
                "‡™∂‡´Å‡™Ç ‡™§‡™Æ‡´á ‡™§‡™æ‡™ú‡´á‡™§‡™∞‡™Æ‡™æ‡™Ç ‡™™‡´ã‡™∑‡™ï ‡™¶‡´ç‡™∞‡™æ‡™µ‡™£ ‡™∏‡´ç‡™§‡™∞ ‡™§‡™™‡™æ‡™∏‡´ç‡™Ø‡´Å‡™Ç ‡™õ‡´á? ‡™∏‡´ç‡™•‡™ø‡™∞ ‡™µ‡´É‡™¶‡´ç‡™ß‡™ø ‡™Æ‡™æ‡™ü‡´Ä ‡™ü‡´ã‡™™‡™ø‡™Ç‡™ó ‡™Ö‡™™ ‡™ï‡´Ä ‡™õ‡´á.",
                "‡™ú‡´ã ‡™∂‡™ï‡´ç‡™Ø ‡™π‡´ã‡™Ø ‡™§‡´ã ‡™™‡´å‡™ß‡™æ‡™®‡´á ‡™´‡´á‡™∞‡™µ‡´ã ‡™ú‡´á‡™•‡´Ä ‡™§‡´á‡™ì‡™®‡´á ‡™∏‡™Æ‡™æ‡™® ‡™™‡´ç‡™∞‡™ï‡™æ‡™∂ ‡™Æ‡™≥‡´á.",
                "‡™Ö‡™∏‡™Ç‡™§‡´Å‡™≤‡™® ‡™ü‡™æ‡™≥‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´Ä pH ‡™∏‡™æ‡™•‡´á EC ‡™∏‡´ç‡™§‡™∞‡™®‡´Å‡™Ç ‡™®‡™ø‡™∞‡´Ä‡™ï‡´ç‡™∑‡™£ ‡™ï‡™∞‡´ã.",
                "‡™Æ‡´Ç‡™≥ ‡™Ü‡™∞‡´ã‡™ó‡´ç‡™Ø ‡™µ‡™ß‡™æ‡™∞‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´Ä ‡™≤‡™æ‡™≠‡™¶‡™æ‡™Ø‡´Ä ‡™Æ‡™æ‡™á‡™ï‡´ç‡™∞‡´ã‡™¨‡´ç‡™∏ ‡™â‡™Æ‡´á‡™∞‡™µ‡™æ ‡™µ‡™ø‡™ö‡™æ‡™∞‡´ã.",
                "‡™™‡´ç‡™∞‡™ï‡™æ‡™∂ ‡™™‡´ç‡™∞‡™µ‡´á‡™∂‡™Æ‡™æ‡™Ç ‡™∏‡´Å‡™ß‡™æ‡™∞‡´ã ‡™Ö‡™®‡´á ‡™∞‡´ã‡™ó ‡™ú‡´ã‡™ñ‡™Æ ‡™ò‡™ü‡™æ‡™°‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´Ä ‡™Æ‡´É‡™§ ‡™™‡™æ‡™Ç‡™¶‡™°‡™æ ‡™ï‡™æ‡™™‡´ã."
            ],
            botMessages: {
                phLowCritical: "üö® ‡™ó‡™Ç‡™≠‡´Ä‡™∞: pH ‡™ú‡´ã‡™ñ‡™Æ‡´Ä ‡™∞‡´Ä‡™§‡´á ‡™®‡´Ä‡™ö‡´Å‡™Ç (‡™è‡™∏‡™ø‡™°‡™ø‡™ï)! ‡™™‡´ã‡™∑‡™ï ‡™≤‡´ã‡™ï‡™Ü‡™â‡™ü ‡™•‡™à ‡™∂‡™ï‡´á‚Äî‡™§‡™∞‡™§ pH ‡™Ö‡™™ ‡™â‡™Æ‡´á‡™∞‡´ã ‡™Ö‡™®‡´á ‡™´‡™∞‡´Ä ‡™§‡™™‡™æ‡™∏‡´ã.",
                phHighCritical: "üö® ‡™ó‡™Ç‡™≠‡´Ä‡™∞: pH ‡™ú‡´ã‡™ñ‡™Æ‡´Ä ‡™∞‡´Ä‡™§‡´á ‡™ä‡™Ç‡™ö‡´Å‡™Ç (‡™Ü‡™≤‡´ç‡™ï‡™≤‡™æ‡™á‡™®)! ‡™™‡´ã‡™∑‡™ï ‡™≤‡´ã‡™ï‡™Ü‡™â‡™ü ‡™ú‡´ã‡™ñ‡™Æ‚ÄîpH ‡™°‡™æ‡™â‡™® ‡™â‡™Æ‡´á‡™∞‡´ã ‡™Ö‡™®‡´á ‡™®‡™ú‡´Ä‡™ï‡™•‡´Ä ‡™®‡™ø‡™∞‡´Ä‡™ï‡´ç‡™∑‡™£ ‡™ï‡™∞‡´ã.",
                tempLowCritical: "üö® ‡™ó‡™Ç‡™≠‡´Ä‡™∞: ‡™™‡™æ‡™£‡´Ä‡™®‡´Å‡™Ç ‡™§‡™æ‡™™‡™Æ‡™æ‡™® ‡™ñ‡´Ç‡™¨ ‡™†‡™Ç‡™°‡´Å‡™Ç! ‡™Æ‡´Ç‡™≥ ‡™Ü‡™ò‡™æ‡™§ ‡™Æ‡™≥‡´Ä ‡™∂‡™ï‡´á; ‡™π‡´Ä‡™ü‡™∞ ‡™µ‡™æ‡™™‡™∞‡´ã ‡™Ö‡™•‡™µ‡™æ ‡™ú‡™≥‡™æ‡™∂‡™Ø‡™®‡´á ‡™á‡™®‡´ç‡™∏‡´ç‡™Ø‡´Å‡™≤‡´á‡™ü ‡™ï‡™∞‡´ã.",
                tempHighCritical: "üö® ‡™ó‡™Ç‡™≠‡´Ä‡™∞: ‡™™‡™æ‡™£‡´Ä ‡™ñ‡´Ç‡™¨ ‡™ó‡™∞‡™Æ! ‡™ì‡™ï‡´ç‡™∏‡™ø‡™ú‡™® ‡™∏‡´ç‡™§‡™∞ ‡™ò‡™ü‡´Ä ‡™∞‡™π‡´ç‡™Ø‡´Å‡™Ç‚Äî‡™è‡™∞‡´á‡™∂‡™® ‡™â‡™Æ‡´á‡™∞‡´ã ‡™Ö‡™•‡™µ‡™æ ‡™∏‡™ø‡™∏‡´ç‡™ü‡™Æ‡™®‡´á ‡™†‡™Ç‡™°‡´Ä ‡™ï‡™∞‡´ã.",
                phLowWarning: "‚ö†Ô∏è pH ‡™•‡´ã‡™°‡´Å‡™Ç ‡™è‡™∏‡™ø‡™°‡™ø‡™ï. ‡™™‡´Ä‡™≥‡™æ ‡™™‡™æ‡™Ç‡™¶‡™°‡™æ ‡™™‡™∞ ‡™®‡™ú‡™∞ ‡™∞‡™æ‡™ñ‡´ã; pH ‡™è‡™°‡™ú‡™∏‡´ç‡™ü‡™∞‡™®‡´Ä ‡™®‡™æ‡™®‡´Ä ‡™°‡´ã‡™ù ‡™µ‡™ø‡™ö‡™æ‡™∞‡´ã.",
                phHighWarning: "‚ö†Ô∏è pH ‡™•‡´ã‡™°‡´Å‡™Ç ‡™Ü‡™≤‡´ç‡™ï‡™≤‡™æ‡™á‡™®. ‡™™‡´ã‡™∑‡™ï ‡™∂‡´ã‡™∑‡™£ ‡™ñ‡™∞‡™æ‡™¨ ‡™•‡™à ‡™∂‡™ï‡´á; ‡™§‡™™‡™æ‡™∏‡´ã ‡™Ö‡™®‡´á ‡™∏‡™Æ‡™æ‡™Ø‡´ã‡™ú‡™ø‡™§ ‡™ï‡™∞‡´ã.",
                wateringTimeOff: "üíß ‡™™‡™æ‡™£‡´Ä ‡™Ü‡™™‡™µ‡™æ‡™®‡´ã ‡™∏‡™Æ‡™Ø! ‡™™‡™Ç‡™™ ‡™¨‡™Ç‡™ß ‡™õ‡´á‚Äî‡™™‡´Ä‡™ï ‡™ï‡™≤‡™æ‡™ï‡´ã ‡™¶‡™∞‡™Æ‡™ø‡™Ø‡™æ‡™® ‡™™‡´å‡™ß‡™æ‡™ì‡™®‡´á ‡™π‡™æ‡™á‡™°‡´ç‡™∞‡´á‡™ü‡´á‡™° ‡™∞‡™æ‡™ñ‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´Ä ‡™ö‡™æ‡™≤‡´Å ‡™ï‡™∞‡´ã.",
                wateringDoneOn: "‚úÖ ‡™™‡™æ‡™£‡´Ä ‡™ö‡™ï‡´ç‡™∞ ‡™™‡´Ç‡™∞‡´ç‡™£. ‡™™‡™Ç‡™™ ‡™Ö‡™®‡™æ‡™µ‡™∂‡´ç‡™Ø‡™ï ‡™∞‡´Ä‡™§‡´á ‡™ö‡™æ‡™≤‡´Å? ‡™ä‡™∞‡´ç‡™ú‡™æ ‡™¨‡™ö‡™æ‡™µ‡™µ‡™æ ‡™Ö‡™®‡´á ‡™µ‡™ß‡™æ‡™∞‡´á ‡™™‡™æ‡™£‡´Ä‡™•‡´Ä ‡™¨‡™ö‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´Ä ‡™¨‡™Ç‡™ß ‡™ï‡™∞‡´ã.",
                hotSunnyPumpOff: "‚òÄÔ∏èüíß ‡™™‡™æ‡™£‡´Ä ‡™∏‡´ç‡™≤‡´ã‡™ü ‡™¶‡™∞‡™Æ‡™ø‡™Ø‡™æ‡™® ‡™ó‡™∞‡™Æ ‡™Ö‡™®‡´á ‡™∏‡´Ç‡™∞‡´ç‡™Ø‡™æ‡™≤‡´ã‡™ï‡™ø‡™§! ‡™¨‡™æ‡™∑‡´ç‡™™‡´Ä‡™ï‡™∞‡™£ ‡™§‡™£‡™æ‡™µ ‡™∏‡™æ‡™Æ‡´á ‡™≤‡™°‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´Ä ‡™π‡™µ‡´á ‡™™‡™Ç‡™™ ‡™∏‡™ï‡´ç‡™∞‡™ø‡™Ø ‡™ï‡™∞‡´ã.",
                goodMorning: "üåÖ ‡™∏‡´Å‡™™‡´ç‡™∞‡™≠‡™æ‡™§! ‡™∏‡™ø‡™∏‡´ç‡™ü‡™Æ ‡™∏‡´ç‡™•‡™ø‡™∞‚Äî‡™µ‡´É‡™¶‡´ç‡™ß‡™ø ‡™Æ‡™æ‡™ü‡´Ä ‡™∏‡™Ç‡™™‡´Ç‡™∞‡´ç‡™£ ‡™¶‡™ø‡™µ‡™∏. ‡™ù‡™°‡™™‡´Ä ‡™ü‡™ø‡™™: ‡™∏‡™µ‡™æ‡™∞‡™®‡´Ä ‡™ï‡™æ‡™ú‡™≤ ‡™™‡™∞ ‡™§‡™™‡™æ‡™∏‡´ã.",
                goodEvening: "üåô ‡™∂‡´Å‡™≠ ‡™∏‡™æ‡™Ç‡™ú. ‡™Ö‡™π‡´Ä‡™Ç ‡™¨‡™ß‡´Å‡™Ç ‡™∏‡™æ‡™∞‡´Å‡™Ç. ‡™∏‡™æ‡™Ç‡™ú‡™®‡™æ ‡™ï‡´Ä‡™ü‡™ï‡´ã ‡™§‡™™‡™æ‡™∏‡´Ä‡™®‡´á ‡™Ü‡™∞‡™æ‡™Æ ‡™ï‡™∞‡´ã.",
                status: "üìä ‡™µ‡™∞‡´ç‡™§‡™Æ‡™æ‡™® ‡™∏‡´ç‡™•‡™ø‡™§‡™ø: ‡™§‡™æ‡™™‡™Æ‡™æ‡™®: {temp}¬∞C, pH: {ph}, ‡™≠‡´á‡™ú: {moisture}%. ‡™π‡™µ‡™æ‡™Æ‡™æ‡™®: {weather}. ‡™™‡™Ç‡™™: {pump}. ‡™¨‡™ß‡´Å‡™Ç ‡™ë‡™™‡´ç‡™ü‡™ø‡™Æ‡™≤ ‡™≤‡™æ‡™ó‡´á ‡™õ‡´á!",
                tip: "üí° {tip}",
                phAdvice: "üß™ ‡™π‡™æ‡™á‡™°‡´ç‡™∞‡´ã‡™™‡´ã‡™®‡™ø‡™ï‡´ç‡™∏ ‡™Æ‡™æ‡™ü‡´Ä ‡™Ü‡™¶‡™∞‡´ç‡™∂ pH: 5.5-6.5‡•§ ‡™§‡™Æ‡™æ‡™∞‡´Å‡™Ç {ph} ‡™™‡™∞‚Äî‡™ú‡´ã ‡™ë‡™´, ‡™ß‡´Ä‡™Æ‡´á ‡™ß‡´Ä‡™Æ‡´á ‡™∏‡™Æ‡™æ‡™Ø‡´ã‡™ú‡™ø‡™§ ‡™ï‡™∞‡´ã (0.2-0.3 ‡™è‡™ï‡™Æ) ‡™Ö‡™®‡´á 30 ‡™Æ‡™ø‡™®‡™ø‡™ü‡™Æ‡™æ‡™Ç ‡™´‡™∞‡´Ä ‡™§‡™™‡™æ‡™∏‡´ã.",
                tempAdvice: "üå°Ô∏è ‡™ë‡™™‡´ç‡™ü‡™ø‡™Æ‡™≤ ‡™™‡™æ‡™£‡´Ä ‡™§‡™æ‡™™‡™Æ‡™æ‡™®: 18-24¬∞C‡•§ {temp}¬∞C ‡™™‡™∞, ‡™Æ‡´Ç‡™≥ ‡™∏‡™°‡™µ‡™æ‡™•‡´Ä ‡™¨‡™ö‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´Ä ‡™∏‡™æ‡™∞‡´Ä ‡™ë‡™ï‡´ç‡™∏‡™ø‡™ú‡™®‡´á‡™∂‡™® ‡™∏‡´Å‡™®‡™ø‡™∂‡´ç‡™ö‡™ø‡™§ ‡™ï‡™∞‡´ã.",
                moistureAdvice: "üí¶ ‡™Æ‡™æ‡™ü‡´Ä ‡™≠‡´á‡™ú ‡™Ü‡™¶‡™∞‡´ç‡™∂: 40-60%‡•§ {moisture}% ‡™™‡™∞, {moistureAdvice}‡•§",
                weatherImpact: "‚òÅÔ∏è {weatherTemp}¬∞C ‡™™‡™∞ {weather} ‡™∏‡™æ‡™•‡´á, {weatherTip}‡•§",
                unknown: "ü§î ‡™Æ‡™æ‡™´ ‡™ï‡™∞‡™∂‡´ã, ‡™π‡´Å‡™Ç ‡™∏‡™Æ‡™ú‡´Ä ‡™®‡™•‡´Ä. 'status', 'tip', 'pH ‡™∏‡™≤‡™æ‡™π' ‡™Ö‡™ú‡™Æ‡™æ‡™µ‡´ã ‡™Ö‡™•‡™µ‡™æ ‡™∏‡™Æ‡™∏‡´ç‡™Ø‡™æ ‡™µ‡™∞‡´ç‡™£‡™® ‡™ï‡™∞‡´ã!"
            },
            botInit: `‡™®‡™Æ‡™∏‡´ç‡™ï‡™æ‡™∞! AgriBot ${time} ‡™™‡™∞ ‡™∏‡™ï‡´ç‡™∞‡™ø‡™Ø. ‡™π‡´Å‡™Ç ‡™®‡™ø‡™∞‡´Ä‡™ï‡´ç‡™∑‡™£, ‡™∏‡™≤‡™æ‡™π ‡™Ö‡™®‡´á ‡™§‡™Æ‡™æ‡™∞‡™æ ‡™ó‡´ç‡™∞‡´ã ‡™ë‡™™ ‡™µ‡™ø‡™∂‡´á ‡™µ‡™æ‡™§ ‡™ï‡™∞‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´Ä ‡™Ö‡™π‡´Ä‡™Ç ‡™õ‡´Å‡™Ç. ‡™ï‡´ã‡™à‡™™‡™£ ‡™∏‡™Æ‡™Ø‡´á ‡™Æ‡™®‡´á ‡™ï‡´ç‡™≤‡™ø‡™ï ‡™ï‡™∞‡´ã!`,
            chatPlaceholder: "‡™§‡™Æ‡™æ‡™∞‡™æ ‡™∏‡™ø‡™∏‡´ç‡™ü‡™Æ ‡™µ‡™ø‡™∂‡´á ‡™™‡´Ç‡™õ‡´ã... (‡™â‡™¶‡™æ‡™π‡™∞‡™£: 'status', 'tip', 'pH ‡™∏‡™≤‡™æ‡™π')"
        }
    };

    // Enhanced bot state with chat history
    const botState = { 
        messageLog: [], 
        chatHistory: [],
        MAX_LOG_MESSAGES: 20, 
        MAX_CHAT_HISTORY: 50,
        tipIndex: 0, 
        lastGreetingHour: -1 
    };

    const isWateringTime = hour => (hour >= 7 && hour < 9) || (hour >= 12 && hour < 14) || (hour >= 17 && hour < 19);

    // Enhanced weather tips
    const weatherTips = {
        Clear: "Clear skies‚Äîgreat for growth, but watch for heat stress if sunny.",
        Clouds: "Cloudy‚Äîideal for reducing transpiration; no extra watering needed.",
        Rain: "Rainy‚Äîcheck for overwatering; ensure good drainage.",
        Drizzle: "Light drizzle‚Äîmild boost; monitor humidity spikes.",
        Thunderstorm: "Stormy‚Äîsecure setup; pause watering to avoid flooding.",
        Snow: "Snowy‚Äîinsulate roots; low light, consider supplements.",
        Fog: "Foggy‚Äîhigh humidity; ventilate to prevent mold."
    };

    const getTextFromKey = (key, dynamicData = {}) => {
        const trans = translations[currentLanguage];
        let message = trans.botMessages[key] || trans.botMessages.unknown;

        // Replace placeholders
        Object.keys(dynamicData).forEach(placeholder => {
            const regex = new RegExp(`{${placeholder}}`, 'g');
            message = message.replace(regex, dynamicData[placeholder]);
        });

        if (key === 'init') {
            return trans.botInit.replace('${time}', dynamicData.time || '');
        } else if (key.startsWith('tip')) {
            const index = parseInt(key.slice(3)) % trans.proactiveTips.length;
            return trans.botMessages.tip.replace('{tip}', trans.proactiveTips[index]);
        } else if (key === 'moistureAdvice') {
            const moisture = dynamicData.moisture || 0;
            return moisture < 40 ? "increase watering frequency." : moisture > 60 ? "reduce to prevent root rot." : "steady as she goes.";
        } else if (key === 'weatherImpact') {
            const weather = dynamicData.weatherCondition || 'Unknown';
            const temp = dynamicData.weatherTemp || '--';
            return trans.botMessages.weatherImpact.replace('{weather}', weather).replace('{weatherTemp}', temp).replace('{weatherTip}', weatherTips[weather] || 'keep monitoring.');
        }

        return message;
    };

    const renderBotLog = () => {
        elements.botLogTooltip.innerHTML = '';
        botState.messageLog.slice(0, botState.MAX_LOG_MESSAGES).forEach((msg) => {
            const text = getTextFromKey(msg.key, msg.dynamicData || {});
            const newLogEntry = document.createElement('div');
            newLogEntry.className = 'bot-log-message';
            newLogEntry.innerHTML = `<span>${text}</span><span class="timestamp">${msg.timestamp} - ${msg.type}</span>`;
            elements.botLogTooltip.appendChild(newLogEntry);
        });
        elements.botLogTooltip.scrollTop = 0; // Auto-scroll to top for newest
    };

    const logBotMessage = (key, type, dynamicData = {}) => {
        const currentText = getTextFromKey(key, dynamicData);
        if (botState.messageLog.length > 0 && getTextFromKey(botState.messageLog[0].key, botState.messageLog[0].dynamicData) === currentText) return;
        const timestamp = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        botState.messageLog.unshift({ key, type, timestamp, dynamicData });
        if (botState.messageLog.length > botState.MAX_LOG_MESSAGES) botState.messageLog.pop();
        renderBotLog();
        updateBotMessage();
    };

    const updateBotMessage = () => {
        const latestCritical = botState.messageLog.find(msg => msg.type === 'critical');
        if (latestCritical) {
            elements.botMessage.innerHTML = getTextFromKey(latestCritical.key, latestCritical.dynamicData);
            elements.botMessage.classList.add('visible');
        } else {
            elements.botMessage.classList.remove('visible');
        }
    };

    // New: Chat functionality
    const addChatMessage = (text, isUser = false) => {
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${isUser ? 'user-message' : 'bot-message'}`;
        messageDiv.innerHTML = `<span>${text}</span>`;
        chatElements.chatMessages.appendChild(messageDiv);
        chatElements.chatMessages.scrollTop = chatElements.chatMessages.scrollHeight;
        botState.chatHistory.push({ text, isUser, timestamp: new Date().toISOString() });
        if (botState.chatHistory.length > botState.MAX_CHAT_HISTORY) botState.chatHistory.shift();
    };

    const processUserInput = (input, data) => {
        const lowerInput = input.toLowerCase().trim();
        let responseKey = 'unknown';
        let dynamicData = { ...data };

        if (lowerInput.includes('status') || lowerInput.includes('report')) {
            responseKey = 'status';
            dynamicData.pump = elements.pumpSwitch.checked ? 'ON' : 'OFF';
        } else if (lowerInput.includes('tip') || lowerInput.includes('advice')) {
            responseKey = 'tip' + Math.floor(Math.random() * translations[currentLanguage].proactiveTips.length);
        } else if (lowerInput.includes('ph') || lowerInput.includes('acid') || lowerInput.includes('alkaline')) {
            responseKey = 'phAdvice';
        } else if (lowerInput.includes('temp') || lowerInput.includes('temperature')) {
            responseKey = 'tempAdvice';
        } else if (lowerInput.includes('moisture') || lowerInput.includes('soil')) {
            responseKey = 'moistureAdvice';
        } else if (lowerInput.includes('weather') || lowerInput.includes('rain')) {
            responseKey = 'weatherImpact';
        } else if (lowerInput.includes('pump') || lowerInput.includes('water')) {
            responseKey = isWateringTime(new Date().getHours()) ? 'wateringTimeOff' : 'wateringDoneOn';
        }

        const response = getTextFromKey(responseKey, dynamicData);
        addChatMessage(response, false);
        logBotMessage(responseKey, 'chat', dynamicData); // Log chat responses too
    };

    const toggleChat = () => {
        const isVisible = chatElements.chatContainer.style.display === 'block';
        chatElements.chatContainer.style.display = isVisible ? 'none' : 'block';
        if (!isVisible) {
            chatElements.chatInput.focus();
            addChatMessage("Hi! I'm AgriBot. How can I help with your farm today? Try 'status' for a quick overview.", false);
        }
    };

    chatElements.sendMessage.addEventListener('click', () => {
        const input = chatElements.chatInput.value.trim();
        if (input) {
            addChatMessage(input, true);
            processUserInput(input, { temp: parseFloat(elements.tempValue.textContent), ph: parseFloat(elements.phValue.textContent), moisture: parseFloat(elements.moistureValue.textContent), weatherCondition: elements.weatherDesc.textContent, weatherTemp: parseFloat(elements.weatherTemp.textContent) });
            chatElements.chatInput.value = '';
        }
    });

    chatElements.chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') chatElements.sendMessage.click();
    });

    chatElements.closeChat.addEventListener('click', () => {
        chatElements.chatContainer.style.display = 'none';
    });

    const setLanguage = (lang) => {
        currentLanguage = lang;
        const trans = translations[lang];
        elements.title.innerText = trans.title;
        elements.footer.innerText = trans.footer;
        elements.feelsLikeLabel.innerText = trans.feelsLike;
        elements.humidityLabel.innerText = trans.humidity;
        elements.windLabel.innerText = trans.wind;
        elements.waterTempHeader.innerText = trans.waterTemperature;
        elements.waterPhHeader.innerText = trans.waterPhLevel;
        elements.soilMoistureHeader.innerText = trans.soilMoisture;
        elements.pumpControlHeader.innerText = trans.pumpControl;
        tempChart.options.scales.x.title.text = trans.time;
        tempChart.options.scales.y.title.text = `${trans.waterTemperature} (¬∞C)`;
        tempChart.data.datasets[0].label = `${trans.waterTemperature} (¬∞C)`;
        tempChart.update();
        phChart.options.scales.x.title.text = trans.time;
        phChart.options.scales.y.title.text = trans.waterPhLevel;
        phChart.data.datasets[0].label = trans.waterPhLevel;
        phChart.update();
        chatElements.chatInput.placeholder = trans.chatPlaceholder;
        renderBotLog();
        updateBotMessage();
    };

    elements.languageSelect.addEventListener('change', () => setLanguage(elements.languageSelect.value));

    function updateBotLogic(data) {
        const { temp, ph, weatherCondition, weatherTemp, pumpIsOn } = data;
        const currentHour = new Date().getHours();
        let message = null;
        let dynamicData = { temp, ph, weatherCondition, weatherTemp };

        // Priority: Criticals
        if (ph < 4) { message = { key: 'phLowCritical', type: "critical", dynamicData }; }
        else if (ph > 8) { message = { key: 'phHighCritical', type: "critical", dynamicData }; }
        else if (temp < 15) { message = { key: 'tempLowCritical', type: "critical", dynamicData }; }
        else if (temp > 35) { message = { key: 'tempHighCritical', type: "critical", dynamicData }; }
        // Warnings
        else if (ph < 4.5) { message = { key: 'phLowWarning', type: "warning", dynamicData }; }
        else if (ph > 7.5) { message = { key: 'phHighWarning', type: "warning", dynamicData }; }
        // Suggestions with weather integration
        else if (isWateringTime(currentHour) && !pumpIsOn) { message = { key: 'wateringTimeOff', type: "suggestion", dynamicData }; }
        else if (!isWateringTime(currentHour) && pumpIsOn) { message = { key: 'wateringDoneOn', type: "suggestion", dynamicData }; }
        else if (weatherCondition === 'Clear' && weatherTemp > 29 && !pumpIsOn && isWateringTime(currentHour)) { 
            message = { key: 'hotSunnyPumpOff', type: "suggestion", dynamicData }; 
        }
        // Greetings & Tips
        else {
            if (currentHour >= 6 && currentHour < 12 && botState.lastGreetingHour !== currentHour) {
                message = { key: 'goodMorning', type: "greeting", dynamicData };
                botState.lastGreetingHour = currentHour;
            } else if (currentHour >= 18 && currentHour < 22 && botState.lastGreetingHour !== currentHour) {
                message = { key: 'goodEvening', type: "greeting", dynamicData };
                botState.lastGreetingHour = currentHour;
            } else if (Math.random() < 0.3 && (!botState.messageLog.length || botState.messageLog[0].type !== 'tip')) { // 30% chance for random tip
                message = { key: `tip${botState.tipIndex}`, type: "tip", dynamicData };
                botState.tipIndex = (botState.tipIndex + 1) % translations[currentLanguage].proactiveTips.length;
            }
        }
        if (message) logBotMessage(message.key, message.type, message.dynamicData);
    }

    const throttle = (func, limit) => { 
        let inThrottle; 
        return function() { 
            if (!inThrottle) { 
                func.apply(this, arguments); 
                inThrottle = true; 
                setTimeout(() => inThrottle = false, limit); 
            } 
        } 
    };

    const updateUI = (data) => {
        const { temp, ph, moisture, weatherTemp, weatherFeelsLike, weatherHumidity, weatherCondition, weatherWind } = data;
        const trans = translations[currentLanguage];
        elements.tempValue.textContent = (temp ?? '--').toFixed ? temp.toFixed(2) : '--';
        elements.phValue.textContent = (ph ?? '--').toFixed ? ph.toFixed(2) : '--';
        elements.moistureValue.textContent = (moisture ?? '--').toFixed ? moisture.toFixed(2) : '--';
        elements.weatherTemp.textContent = `${(weatherTemp ?? '--').toFixed ? weatherTemp.toFixed(1) : '--'}¬∞C`;
        elements.weatherFeelsLike.textContent = `${(weatherFeelsLike ?? '--').toFixed ? weatherFeelsLike.toFixed(1) : '--'}¬∞C`;
        elements.weatherHumidity.textContent = `${parseInt(weatherHumidity) || '--'}%`;
        elements.weatherWind.textContent = `${(weatherWind ?? '--').toFixed ? weatherWind.toFixed(1) : '--'} km/h`;
        elements.weatherDesc.textContent = trans.weatherConditions[weatherCondition] || weatherCondition || 'Unknown';
        elements.weatherIcon.innerHTML = weatherIcons[weatherCondition] || weatherIcons['Unknown'];

        const time = new Date().toLocaleTimeString();
        const updateChartData = (chart, value) => {
            if (chart.data.labels.length > 20) { 
                chart.data.labels.shift(); 
                chart.data.datasets[0].data.shift(); 
            }
            chart.data.labels.push(time);
            chart.data.datasets[0].data.push(value);
            if (value !== null && value < chart.options.scales.y.min) chart.options.scales.y.min = Math.floor(value - 1);
            if (value !== null && value > chart.options.scales.y.max) chart.options.scales.y.max = Math.ceil(value + 1);
            chart.update('none');
        };
        updateChartData(tempChart, temp);
        updateChartData(phChart, ph);

        elements.tempCard.classList.toggle('card--alert', temp < 15 || temp > 35);
        elements.tempAlert.textContent = temp < 15 ? trans.tempTooLow : temp > 35 ? trans.tempTooHigh : '';
        elements.phCard.classList.toggle('card--alert', ph < 4.5 || ph > 7.5);
        elements.phAlert.textContent = ph < 4.5 ? trans.phAcidic : ph > 7.5 ? trans.phAlkaline : '';
        elements.moistureCard.classList.toggle('card--alert', moisture < 20 || moisture > 80);
        elements.moistureAlert.textContent = moisture < 20 ? trans.moistureTooLow : moisture > 80 ? trans.moistureTooHigh : '';
        
        updateBotLogic({ ...data, pumpIsOn: elements.pumpSwitch.checked });
    };

    const throttledUpdateUI = throttle(updateUI, 1000);

    function connectWebSocket() {
        const ws = new WebSocket('https://0m4jwn6h-6789.inc1.devtunnels.ms/'); // Use WSS for security
        ws.onopen = () => console.log('WebSocket connected');
        ws.onmessage = (event) => {
            const data = event.data.split(',');
            if (data.length >= 8) {
                const [sensorTemp, sensorPh, moisture, weatherTemp, weatherFeelsLike, weatherHumidity, weatherCondition, weatherWind] = data;
                throttledUpdateUI({
                    temp: parseFloat(sensorTemp) || null,
                    ph: parseFloat(sensorPh) || null,
                    moisture: parseFloat(moisture) || null,
                    weatherTemp: parseFloat(weatherTemp) || null,
                    weatherFeelsLike: parseFloat(weatherFeelsLike) || null,
                    weatherHumidity: parseFloat(weatherHumidity) || null,
                    weatherCondition: weatherCondition.trim() || 'Unknown',
                    weatherWind: parseFloat(weatherWind) || null
                });
            }
        };
        ws.onclose = () => { 
            console.log('WebSocket disconnected, reconnecting...'); 
            setTimeout(connectWebSocket, 5000); 
        };
        ws.onerror = (error) => console.error('WebSocket error:', error);
        elements.pumpSwitch.onchange = () => { 
            if (ws && ws.readyState === WebSocket.OPEN) { 
                ws.send(elements.pumpSwitch.checked ? 'ON' : 'OFF'); 
            } 
        };
    }
    
    // Enhanced interactions
    elements.botAvatar.addEventListener('click', toggleChat);
    document.addEventListener('click', (e) => {
        if (!elements.botContainer.contains(e.target) && !chatElements.chatContainer.contains(e.target)) {
            chatElements.chatContainer.style.display = 'none';
            elements.botLogTooltip.classList.remove('visible');
        }
    });

    // Rotate tips more dynamically
    setInterval(() => { 
        botState.tipIndex = (botState.tipIndex + 1) % translations[currentLanguage].proactiveTips.length; 
    }, 45000); // Slightly longer interval

    setLanguage('en');
    const initTime = new Date().toLocaleTimeString('en-US');
    logBotMessage('init', "greeting", { time: initTime });
    connectWebSocket();
});